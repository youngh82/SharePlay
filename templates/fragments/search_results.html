{% if results %}
<div class="space-y-1">
  {% for song in results %}
  <div
    class="flex items-center justify-between p-2 hover:bg-white/10 rounded-lg transition-colors group"
  >
    <div class="flex items-center space-x-3 flex-1 min-w-0">
      <img
        src="{{ song.album_cover_url }}"
        class="w-10 h-10 rounded shadow-sm object-cover"
      />
      <div class="flex-1 min-w-0">
        <h4 class="font-medium text-slate-200 text-sm truncate">
          {{ song.title }}
        </h4>
        <p class="text-xs text-slate-500 truncate">{{ song.artist }}</p>
      </div>
    </div>
    <button
      onclick="addToQueue('{{ song.spotify_id }}')"
      class="ml-2 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded-md shadow-lg shadow-indigo-500/20 transition-all opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0"
    >
      Add
    </button>
  </div>
  {% endfor %}
</div>
<script>
  async function addToQueue(spotifyId) {
    const authToken = sessionStorage.getItem("auth_token");
    try {
      const response = await fetch("/api/queue/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + authToken,
        },
        body: JSON.stringify({ spotify_id: spotifyId }),
      });
      if (response.ok) {
        document.getElementById("search-input").value = "";
        document.getElementById("search-results").innerHTML = "";
        htmx.trigger("#queue-list", "queueUpdate");
      } else {
        const error = await response.json();
        alert("Error adding song: " + (error.detail || "Unknown error"));
      }
    } catch (err) {
      console.error("Error adding song:", err);
    }
  }
</script>
{% else %}
<div class="text-center py-4 text-slate-500 text-xs">
  {% if query %} No results found for "{{ query }}" {% else %} Start typing...
  {% endif %}
</div>
{% endif %}
